select 
  p.player_id,
  p.player,
  p.position,
  lnd.get_pos(p.position) pos,
  t.team_abbrv,
  pl.season as sea,
  pl.min,
  pl.reb,
  pl.ast,
  pl.blk,
  pl.pts,
  pa.pie,
  pa.pace,
  pl.plus_minus,
  rank() over (partition by pl.season, lnd.get_pos(p.POSITION) order by pl.min::float desc) minutes_rank,
  rank() over (partition by pl.season, lnd.get_pos(p.POSITION) order by pl.reb::float desc) reb_rank,
  rank() over (partition by pl.season, lnd.get_pos(p.POSITION) order by pl.ast::float desc) ast_rank,
  rank() over (partition by pl.season, lnd.get_pos(p.POSITION) order by pl.blk::float desc) blk_rank,
  rank() over (partition by pl.season, lnd.get_pos(p.POSITION) order by pl.pts::float desc) pts_rank,
  rank() over (partition by pl.season, lnd.get_pos(p.POSITION) order by pl.plus_minus::float desc) plus_minus_rank,
  rank() over (partition by pl.season, lnd.get_pos(p.POSITION) order by pa.pace::float desc) pace_rank,
  rank() over (partition by pl.season, lnd.get_pos(p.POSITION) order by pa.pie::float desc) pie_rank
  
from lnd.vw_player_overall_base pl
  INNER JOIN lnd.vw_player_overall_advanced pa on (pl.playerid = pa.playerid and pl.season = pa.season)
  inner join lnd.vw_players p on (pl.playerid = p.player_id and split_part(pl.season,'-',1)::int8 = p.season)
  inner join lnd.vw_teams t on (p.teamid = t.team_id)
where pl.season = '2015-16'  
and pl.min::float > 20
and t.team_id in ( select home_team_id from lnd.game_schedule WHERE game_date = 20151106
		     union 
		   select away_team_id from lnd.game_schedule WHERE game_date = 20151106)
--order by rank() over (partition by pl.season, lnd.get_pos(p.POSITION) order by pl.min::float desc)